# 아키텍처 개요

이 문서는 IaaS 플랫폼의 기술 스택, 현재 아키텍처 및 향후 발전 방향에 대해 설명합니다.

## 1. 핵심 기술 스택

- **언어**: Python 3
- **백엔드**: 순수 WSGI
- **가상화**: KVM/QEMU 및 libvirt-python
- **MSA (향후 도입)**: RabbitMQ 및 Celery
- **개발 환경**: Vagrant와 VirtualBox (중첩 가상화)
- **프론트엔드**: Next.js
- **물리 인프라 (목표)**: 최소 2대 이상의 물리 서버 클러스터. (가용 자원에 따라 유동적 구성)

## 2. 아키텍처 비판 및 고려사항 (AWS/오픈스택 관점)

현재 VM 생성 로직은 Nova-API/EC2 API의 최소 요건을 갖추었지만, 다음 단계에서 아키텍처적 허점이 드러날 수 있습니다.

### 🚨 리스크 1: 디스크 롤백 부재
-   **현황**: `ComputeService.create_vm`에서 VM 생성 중 Libvirt 오류가 나거나 DB 저장 실패가 발생했을 때, 생성된 디스크 복제본이나 DB 레코드를 자동으로 삭제(롤백)하는 로직이 없습니다.
-   **AWS/OpenStack 관점**: 모든 클라우드 작업은 트랜잭션처럼 처리됩니다. 중간에 실패하면 원 상태로 되돌리는 롤백 메커니즘이 필수적입니다.
-   **개선 방향**: `destroy_vm` 로직을 `create_vm`의 `except` 블록 안에서 재사용하는 방식으로 롤백 기능을 구현해야 합니다. 이는 MSA 전환 시 안정성을 높이는 기반이 됩니다.

### 🚨 리스크 2: 비동기 처리의 필요성 (Phase 2 준비)
-   **현황**: `POST /v1/vms` 요청은 VM이 완전히 running 상태가 될 때까지 HTTP 연결을 잡고 기다립니다.
-   **AWS/OpenStack 관점**: VM 생성은 시간이 오래 걸리는 작업이므로, API 서버는 요청을 받자마자 `202 Accepted`를 반환하고, 실제 VM 생성은 **메시지 큐(RabbitMQ)**로 넘겨서 Nova Compute 워커가 비동기적으로 처리합니다.
-   **개선 방향**: 로드맵의 Phase 2가 RabbitMQ/Celery 도입입니다. 지금은 모놀리식이지만, 다음 VM 제어 기능을 만들 때부터 비동기 처리를 염두에 두고 코드를 설계하는 것이 좋습니다.
