# 아키텍처 개요

이 문서는 IaaS 플랫폼의 기술 스택, 현재 아키텍처 및 향후 발전 방향에 대해 설명합니다.

## 1. 핵심 기술 스택

- **언어**: Python 3
- **백엔드**: 순수 WSGI
- **가상화**: KVM/QEMU 및 libvirt-python
- **MSA (향후 도입)**: RabbitMQ 및 Celery
- **개발 환경**: Vagrant와 VirtualBox (중첩 가상화)
- **프론트엔드**: Next.js
- **물리 인프라 (목표)**: 최소 2대 이상의 물리 서버 클러스터. (가용 자원에 따라 유동적 구성)



## 2. 🧐 아키텍처 검토 및 비판

현재 프로젝트의 아키텍처를 검토했을 때, 향후 확장성을 위해 고려해야 할 세 가지 주요 사항이 있습니다.

1.  **견고성 부족: 롤백(Rollback) 로직 부재**
    -   **현황**: VM 생성 또는 삭제 과정 중 중간에 실패하면, 일부 리소스(디스크 파일, libvirt 정의 등)가 그대로 남아 시스템에 쓰레기 데이터가 쌓입니다.
    -   **위험성**: 이런 '고아 리소스'들은 향후 다른 작업에 예기치 않은 충돌을 일으킬 수 있습니다.
    -   **개선 방향**: 모든 작업 단계를 트랜잭션(Transaction)처럼 관리하여, 실패 시 이전 상태로 되돌리는 롤백 로직을 추가해야 합니다.

2.  **성능 한계: 동기(Synchronous) 처리 방식**
    -   **현황**: VM 생성처럼 시간이 오래 걸리는 작업을 요청하면, 완료될 때까지 API가 응답을 주지 않고 계속 기다립니다.
    -   **위험성**: 사용자가 많아지면 서버의 가용 스레드가 모두 고갈되어 새로운 요청을 처리하지 못하는 상태가 될 수 있습니다.
    **개선 방향**: 로드맵에 있듯이, RabbitMQ 같은 메시지 큐를 도입하여 오래 걸리는 작업은 백그라운드에서 비동기적으로 처리하도록 구조를 변경해야 합니다.

3.  **(New) 비효율적인 목록 조회: N+1 문제**
    -   **현황**: 방금 개선한 `list_vms`는 DB에서 N개의 VM을 조회한 뒤, 각 VM의 상태를 확인하기 위해 N번의 libvirt API를 추가로 호출합니다.
    -   **위험성**: VM의 개수가 많아지면 `GET /v1/vms` API의 응답 속도가 급격히 느려집니다.
    -   **개선 방향**: `self.conn.listAllDomains()` 같은 함수로 libvirt의 모든 VM 상태를 **한 번에** 가져온 후, DB에서 가져온 정보와 메모리상에서 합치는 방식으로 리팩토링하여 API 호출 횟수를 줄여야 합니다.